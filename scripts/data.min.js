$(function(){var a=0;var e=$(".content").length;var c=$(".content").width();var b=15;var d="<audio id='audioPlayer'></audio>";$(".play_wrap").append(d);WJ.get(DB_api.channels,function(l){var h=l.data.channels;var f=l.data.channels.length;var m="";var k=null;var j=null;for(var g=0;g<f;g++){m+="<li><a href='javascript:void(0);' class='ch_item'><div class='ch_info_front rs_slide_front'><img src='"+h[g].banner+"' alt='"+h[g].name+"'></div><div class='ch_info_back rs_slide_back'><p class='back_word'>"+h[g].intro+"</p></div></a></li>"}$(".ch_wrapper ul").append(m);$(".ch_wrapper li").each(function(){var i=$(this).find(".back_word");if(i.text().length>b){i.text(i.text().substr(0,15))}});$(".ch_wrapper").addClass("rt_flow");var k=setTimeout(function(){$(".ch_wrapper li:even").find(".ch_item").addClass("hot")},700);var j=setTimeout(function(){$(".ch_wrapper li:odd").find(".ch_item").addClass("hot")},1200);$(".ch_item").hammer().on("pan",function(i){if($(this).hasClass("hot")){$(this).removeClass("hot")}else{$(this).addClass("hot")}});$(".ch_wrapper li .ch_item").hammer().on("tap",function(){$(".banner_bg,.rmg_block,.song_list,.info_mark_wrap,.info_tit,.info_con").html("");var q=$(this);var p=$(this).parent().index();var i=[];var o=q.find(".ch_info_front img").clone(true);var n=h[p].name;var r=h[p].intro;WJ.get(DB_api.song_list+"&channel="+p,function(v){var t=v.song;var s=v.song.length;var w="";for(var u=0;u<s;u++){w+="<li><a href='javascript:void(0);'><span class='song_name'>"+t[u].title+"<br><i class='people_name'>"+t[u].artist+"</i></a></li>";i.push(t[u].url)}$(".banner_bg,.rmg_block").append(o);$(".song_list").append(w);$(".info_mark_wrap").append("<span class='mark_bg'>"+n+"</span>");$(".info_tit").append(r);$(".info_con").append(r);a++;container_flow(q.parents(".container"),-c*a,$(".content").eq(a).height());tabFlow();$(".song_list li,.play_random").hammer().on("tap",function(){var x=$(this).index();play_control("audioPlayer",i,t,x,s);$(".broadcast_btn").hammer().on("tap",function(){var y=0;var z=0;if($(".play_ico").css("display")==="block"){$(".broadcast_btn .play_ico").hide().siblings(".stop_ico").show();Audio.pause();y=0;z=Audio.current_t/20*360;song_pic_rotate($(".play_pic img"),y,z)}else{$(".broadcast_btn .play_ico").show().siblings(".stop_ico").hide();Audio.play();y=Audio.duration_t-Audio.current_t;z=(Audio.duration_t-Audio.current_t)/20*360;song_pic_rotate($(".play_pic img"),y,z)}});$(".pre_btn").hammer().on("tap",function(){$(".play_pic").addClass("fmg_slideX");setTimeout(function(){$(".play_pic").removeClass("fmg_slideX");x--;if(x<0){x=s-1}play_control("audioPlayer",i,t,x,s)},700)});$(".next_btn").hammer().on("tap",function(){$(".play_pic").addClass("zmg_slideX");setTimeout(function(){$(".play_pic").removeClass("zmg_slideX");x++;if(x>s-1){x=0}play_control("audioPlayer",i,t,x,s)},700)});$(".play_random").hammer().on("tap",function(){play_control("audioPlayer",i,t,0,s)});a++;container_flow(q.parents(".container"),-c*a,$(".content").eq(a).height());$(".container").hammer().bind("panend",function(y){if(y.gesture.deltaX>0){a--;if(a<0){a=0}}if(y.gesture.deltaX<0){a++;if(a>e-1){a=e-1}}container_flow($(".container"),-c*a,$(".content").eq(a).height())})})})})})});function play_control(c,f,g,h,i){var d=0;var a=0;clearTimeout(e);clearInterval(b);$(".play_pic").html("");Audio.init(c,f[h]);Audio.play(f[h]);$(".play_pic").append("<img>");$(".play_pic img").attr({src:g[h].picture,alt:g[h].title});$(".broadcast_btn .play_ico").show().siblings(".stop_ico").hide();var e=setTimeout(function(){a=Audio.duration_t;d=Audio.duration_t/20*360;song_pic_rotate($(".play_pic img"),a,d);$(".duration_t").text(addZero(parseInt(a/60))+":"+addZero(parseInt(a%60)))},1000);var b=setInterval(function(){var k=Audio.current_t;if(k===Audio.duration_t){h=h+1;if(h>i-1){h=0}play_control(c,f,g,h,i)}var j=k/a*$(".time_line").width();$(".current_t").text(addZero(parseInt(k/60))+":"+addZero(parseInt(k%60)));$(".time_hot_line").css("width",j+"px");$(".drag_ico").css("left",j+"px")},1000)}function song_pic_rotate(b,c,a){b.css({webkitTransitionDuration:c+"s",TransitionDuration:c+"s",webkitTransform:"rotate("+a+"deg)",transform:"rotate("+a+"deg)"})}function container_flow(c,b,a){Translate(c,b+"px");c.css("height",a+"px")}function addZero(a){if(a>=0&&a<=9){return a="0"+a}else{return a}}function Translate(b,a){b.css({"-webkit-transform":"perspective(800px) translate("+a+")","-moz-transform":"perspective(800px) translate("+a+")",transform:"perspective(800px) translate("+a+")"})};
